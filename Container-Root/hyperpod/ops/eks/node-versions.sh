#!/bin/bash

help(){
	echo ""
	echo "Usage: $0 <node_name>"
	echo "       node_name     - required, partial or full node name from which to disply versions of interest"
	echo "       Reference:      https://github.com/aws-smples/awsome-distribted-training/4.validation_and_observability/versions.sh"
	echo ""
}

if [ "$1" == "" ]; then
	help
else

	node_name=$1

	CMD="echo 'IyEvYmluL2Jhc2gKCmlmIFsgLWYgL2V0Yy9vcy1yZWxlYXNlIF07IHRoZW4KCWVjaG8gIiIKCWVjaG8gIk9TIGluZm86IgoJY2F0IC9ldGMvb3MtcmVsZWFzZSB8IGhlYWQgLW4gNApmaQoKZWNobyAiIgplY2hvICJMaW51eCBmYW1pbHk6Igp1bmFtZQoKZWNobyAiIgplY2hvICJMaW51eCBLZXJuZWwgdmVyc2lvbjoiCnVuYW1lIC1yCgplY2hvICIiCmVjaG8gIm52aWRpYS1zbWk6Igp3aGljaCBudmlkaWEtc21pCmlmIFsgIiQ/IiA9PSAiMCIgXTsgdGhlbgoJZWNobyAiIgoJZWNobyAiTlZJRElBIHZlcnNpb25zOiIKCU5WSURJQV9EUklWRVI9JChudmlkaWEtc21pIC0tcXVlcnktZ3B1PWRyaXZlcl92ZXJzaW9uIC0tZm9ybWF0PWNzdixub2hlYWRlciAtLWlkPTAgfCBncmVwICdbMC05XS4qJykKCUNVREFfVkVSU0lPTl9TVVBQT1JUPSQobnZpZGlhLXNtaSAtLXZlcnNpb24gfCBncmVwIENVREEgfCBjdXQgLWQgJzonIC1mIDIgfCB4YXJncykKCUNVREFfVkVSU0lPTl9DVVJSRU5UPSQobnZjYyAtLXZlcnNpb24gfCBzZWQgLW4gJ3MvXi4qcmVsZWFzZSBcKFswLTldXCtcLlswLTldXCtcKS4qJC9cMS9wJyB8IGdyZXAgJ1swLTldLionKQogICAgICAgIENVREFfREVGQVVMVF9QQVRIPSQobHMgLWFsaCAvdXNyL2xvY2FsIHwgYXdrICd7cHJpbnQgJDkgJDEwICQxMX0nIHwgZ3JlcCBjdWRhIHwgZ3JlcCBcPikKCWVjaG8gIkRyaXZlciB2ZXJzaW9uICAgICAgICAgICAgICAgICAgICAgOiAkTlZJRElBX0RSSVZFUiIKCWVjaG8gIkNVREEgdmVyc2lvbiBzdXBwb3J0ICAgICAgICAgICAgICAgOiAkQ1VEQV9WRVJTSU9OX1NVUFBPUlQiCgllY2hvICJDVURBIHZlcnNpb24gICAgICAgICAgICAgICAgICAgICAgIDogJENVREFfVkVSU0lPTl9DVVJSRU5UIgoJZWNobyAiQ1VEQSBkZWZhdWx0IHBhdGggICAgICAgICAgICAgICAgICA6IC91c3IvbG9jYWwvJENVREFfREVGQVVMVF9QQVRIIgoKCglDVURBX1ZFUlNJT05TPSQobHMgLWFsaCAvdXNyL2xvY2FsIHwgYXdrICd7cHJpbnQgJDkgJDEwICQxMX0nIHwgZ3JlcCBjdWRhIHwgZ3JlcCAtdiBcPikKCWZvciB2IGluICRDVURBX1ZFUlNJT05TIDsgZG8KICAgICAgICAJTkNDTF9MSUI9JChscyAvdXNyL2xvY2FsLyR2L2xpYi9saWJuY2NsLnNvLiouKi4qIDI+L2Rldi9udWxsKQoJCXNlYXJjaD0ic28uIgoJCU5DQ0xfVkVSU0lPTj0ke05DQ0xfTElCIyokc2VhcmNofQoJCWVjaG8gIk5DQ0wgdmVyc2lvbiAoZm9yICR2KSAgICAgICA6ICROQ0NMX1ZFUlNJT04iCglkb25lCgoJT0ZJX05DQ0xfTElCPSQoc3RyaW5ncyAvb3B0L2F3cy1vZmktbmNjbC9saWIvbGlibmNjbC1uZXQuc28gfCBncmVwICJJbml0aWFsaXppbmcgYXdzLW9maS1uY2NsIikKCU9GSV9OQ0NMX1ZFUlNJT049JChlY2hvICRPRklfTkNDTF9MSUIgfCBjdXQgLWQgJyAnIC1mIDQpCgllY2hvICJBV1MgT0ZJIE5DQ0wgdmVyc2lvbiAgICAgICAgICAgICAgIDogJE9GSV9OQ0NMX1ZFUlNJT04iCgoJaWYgWyAtZiAvdXNyL2xvY2FsL2N1ZGEvZ2RzL3Rvb2xzL2dkc2NoZWNrIF07IHRoZW4KCQllY2hvICIiCgkJZWNobyAiTlZJRElBIEdEUzoiCgkJL3Vzci9sb2NhbC9jdWRhL2dkcy90b29scy9nZHNjaGVjayAtdgoJZmkKZWxzZQoJZWNobyAibm90IHByZXNlbnQiCmZpCgplY2hvICIiCkxVU1RSRV9DTElFTlRfVkVSU0lPTlNfSU5TVEFMTEVEPSJub3QgZm91bmQiCndoaWNoIHl1bQppZiBbICIkPyIgPT0gIjAiIF07IHRoZW4KCUxVU1RSRV9DTElFTlRfVkVSU0lPTlNfSU5TVEFMTEVEPSQoeXVtIGxpc3QgbHVzdHJlLWNsaWVudCB8IGdyZXAgbHVzdHJlLWNsaWVudCB8IGF3ayAne3ByaW50ICQyfScpCmVsc2UKCUxVU1RSRV9DTElFTlRfVkVSU0lPTlNfSU5TVEFMTEVEPSQoYXB0IGxpc3QgbHVzdHJlLWNsaWVudCB8IGdyZXAgbHVzdHJlLWNsaWVudCB8IGN1dCAtZCAnICcgLWYgMikKZmkKTFVTVFJFX0NMSUVOVF9WRVJTSU9OX0xPQURFRD0kKG1vZGluZm8gbHVzdHJlIHwgZ3JlcCAndmVyc2lvbjonIHwgaGVhZCAtbiAxIHwgYXdrICd7cHJpbnQgJDJ9JykKZWNobyAiTHVzdHJlIGNsaWVudCB2ZXJzaW9ucyBpbnN0YWxsZWQ6ICIKZWNobyAiJExVU1RSRV9DTElFTlRfVkVSU0lPTlNfSU5TVEFMTEVEIgplY2hvICJMdXN0cmUgY2xpZW50IHZlcnNpb24gbG9hZGVkICAgICAgIDogJExVU1RSRV9DTElFTlRfVkVSU0lPTl9MT0FERUQiCgplY2hvICIiCmlmIFsgLWYgL29wdC9hbWF6b24vZWZhX2luc3RhbGxlZF9wYWNrYWdlcyBdOyB0aGVuCglFRkFfTElCUz0oJChjYXQgL29wdC9hbWF6b24vZWZhX2luc3RhbGxlZF9wYWNrYWdlcykpCglFRkFfSU5TVEFMTEVSX1ZFUlNJT049JHtFRkFfTElCU1stMV19CgllY2hvICJFRkEgdmVyc2lvbiAgICAgICAgICAgICAgICAgICAgICAgIDogJEVGQV9JTlNUQUxMRVJfVkVSU0lPTiIKCglMSUJGQUJSSUNfVkVSU0lPTj0kKC9vcHQvYW1hem9uL2VmYS9iaW4vZmlfaW5mbyAtLXZlcnNpb24gfCBncmVwIGxpYmZhYnJpYzogfCBjdXQgLWQgJyAnIC1mIDIpCgllY2hvICJMaWJmYWJyaWMgdmVyc2lvbiAgICAgICAgICAgICAgICAgIDogJExJQkZBQlJJQ19WRVJTSU9OIgoKZWxzZQoJZWNobyAiRUZBIEluc3RhbGxlciBub3QgZm91bmQiCmZpCgplY2hvICIiCg==' | base64 -d > /tmp/versions.sh; chmod +x /tmp/versions.sh; source ${HOME}/.bashrc; /tmp/versions.sh"

	node-exec.sh $node_name "$CMD"

fi

